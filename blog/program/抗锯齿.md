---
slug: anti-aliens
title: 抗锯齿
date: 2023-05-17
authors: Kaesar
tags: [blog, CG, Rendering]
keywords: [blog, 抗锯齿, 反走样]
---
锯齿的来源是因为场景的定义在三维空间中是连续的，而最终显示的像素则是一个离散的二维数组。所以判断一个点到底没有被某个像素覆盖的时候单纯是一个“有”或者“没有"问题，丢失了连续性的信息，导致锯齿。

1. **SSAA：** 以4xSSAA 为例，假设最终屏幕输出的分辨率是 800x600，4xSSAA 就会先渲染到一个分辨率 1600x1200 的 buffer 上，然后再直接把这个放大 4 倍的 buffer 下采样至 800x600。这种做法在数学上是最完美的抗锯齿。但是劣势也很明显，光栅化和着色的计算负荷都比原来多了 4倍，render target 的大小也涨了 4 倍。
2. **MSAA：** 在光栅化阶段，判断一个三角形是否被像素覆盖的时候会计算多个覆盖样本（Coverage sample），但是在 pixel shader 着色阶段计算像素颜色的时候每个像素还是只计算一次。下图以 4xMSAA 为例，每个像素包含有4个采样点，三角形只覆盖了 4 个 coverage sample 中的 2 个。每个像素只运行一次片段着色器。片段着色器所使用的顶点数据会插值到每个像素的中心，所得到的结果颜色会被储存在每个被遮盖住的子采样点中。然后对这些值进行平均作为该像素的颜色值，以减少锯齿效应。MSAA 在处理几何边缘时可能会产生伪像。
   <div align="center"> <img src="https://cdn.jsdelivr.net/gh/qzlu-cyber/PicgoLib@main/images/202309151905836.png" /> </div>
3. **FXAA：** 一种基于后处理的抗锯齿技术，其目标是在保持图像边缘细节的同时减少锯齿效应。FXAA 首先会检测图像中的高频变化，这通常表示了锯齿的存在。然后，它会对锯齿部分的像素进行模糊处理，以平滑边缘。FXAA 使用的模糊技术称为区域对角线化模糊（RDP - Rotated Grid Diagonal Processing）。它将图像的对角线区域模糊处理，从而减少锯齿，同时尽量保留高频细节。FXAA 的优势在于其计算开销相对较低，因为它是一个简单的后处理步骤。然而，它可能在处理高对比度边缘时引入一些模糊，因为它不是基于像素的实际几何形状进行抗锯齿。
4. **TXAA（Temporal Antialiasing）：** 一种结合了时间上抗锯齿和空间上抗锯齿的技术，旨在提供高质量的图像边缘平滑效果。TXAA 使用多帧图像的信息来进行抗锯齿处理。它会对当前帧和前一帧之间的图像进行分析，以便更好地确定锯齿部分。TXAA 可以提供非常平滑的图像边缘，但可能会引入一些运动模糊，因为它依赖于时间上的多帧信息。由于 TXAA 需要对多帧图像进行分析和处理，因此它的计算开销相对较高，可能对性能产生影响。
